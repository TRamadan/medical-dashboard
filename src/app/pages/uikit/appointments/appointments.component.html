<p-toast />
<div class="grid grid-cols-12 gap-8 mb-4">
    <div class="col-span-12 md:col-span-6 xl:col-span-3">
        <div class="card !p-0 overflow-hidden flex flex-col border-0">
            <div class="flex items-center p-6">
                <i class="pi pi-check !text-5xl text-green-500"></i>
                <div class="ml-6">
                    <span class="text-green-500 block whitespace-nowrap">Confirmed appointments</span>
                    <span class="text-green-500 block text-4xl font-bold">
                        {{ approvedAppointmentsCount }}
                    </span>
                </div>
            </div>
            <img alt="conversion" class="w-full" src="../../../../assets/users.svg" />
        </div>
    </div>

    <!-- Pending appointments -->
    <div class="col-span-12 md:col-span-6 xl:col-span-3">
        <div class="card !p-0 overflow-hidden flex flex-col border-0">
            <div class="flex items-center p-6">
                <i class="pi pi-clock !text-5xl text-orange-500"></i>
                <div class="ml-6">
                    <span class="text-orange-500 block whitespace-nowrap">Scheduled appointments</span>
                    <span class="text-orange-500 block text-4xl font-bold">
                        {{ pendingAppointmentsCount }}
                    </span>
                </div>
            </div>
            <img alt="conversion" class="w-full" src="assets/users.svg" />
        </div>
    </div>
</div>

<!-- Toolbar -->
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-button icon="pi pi-plus" raised label="New Appointment" class="mr-2" (click)="openNewAppointmentDialog()"></p-button>
    </ng-template>

    <ng-template #end>
        <p-button label="Export" icon="pi pi-upload" severity="secondary"></p-button>
    </ng-template>
</p-toolbar>

<!-- Grouped Appointments by Date -->
@for (group of groupedAppointments; track group) {
    <div>
        <h3 class="text-xl font-semibold mb-3 mt-5">
            {{ group.date | date: 'fullDate' }}
        </h3>

        <app-table
            dataKey="id"
            [headers]="tableHeaders"
            [data]="group.appointments"
            [actions]="tableActions"
            [paginator]="true"
            [rows]="10"
            [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[10, 20, 30]"
            [globalFilterFields]="globalFilterFields"
            [globalFilterPlaceholder]="'Search appointments...'"
            [showActions]="true"
            (edit)="openStatusDialog($event)"
            (onPageChange)="onPageChange($event)"
        ></app-table>
    </div>
}

<!-- New Appointment Dialog -->
<p-dialog header="New Appointment" [(visible)]="displayNewAppointmentDialog" [modal]="true" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
    <ng-template pTemplate="content">
        <app-booking-form></app-booking-form>
    </ng-template>
    <ng-template pTemplate="footer">
        <p-button icon="pi pi-times" (click)="hideDialog()" label="Cancel" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>

<!-- here is the dialog needed to show the status for update the selected appointment-->
<p-dialog header="Change Appointment Status" [(visible)]="displayStatusDialog" [modal]="true" [style]="{ width: '500px' }" [closable]="false">
    <div class="flex flex-wrap gap-3 justify-center mt-3">
        <div class="flex flex-wrap justify-center gap-4 mt-3">
            <div *ngFor="let status of statuses" (click)="selectedStatusId = status.id" class="status-card" [ngClass]="{ selected: selectedStatusId === status.id }">
                <div class="flex flex-col items-center justify-center gap-2">
                    <div class="icon-circle" [ngClass]="'bg-' + status.color + '-100 text-' + status.color + '-600'">
                        <i class="pi pi-check-circle text-xl"></i>
                    </div>
                    <span class="font-medium text-gray-700">{{ status.label }}</span>
                </div>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="cancelStatusChange()"></button>
        <button pButton label="Save" icon="pi pi-check" [disabled]="selectedStatusId === null" (click)="confirmStatusChange()"></button>
    </ng-template>
</p-dialog>

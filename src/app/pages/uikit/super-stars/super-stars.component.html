<p-toast></p-toast>
<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <div class="flex flex-wrap gap-2">
      <p-button icon="pi pi-plus" raised label="New" class="mr-2" (onClick)="openServiceDialog()" />
    </div>
  </ng-template>

  <ng-template #end>
    <p-button label="Export" icon="pi pi-upload" severity="secondary" />
  </ng-template>
</p-toolbar>


<!-- Use the shared dynamic table component -->
<p-card>
  <div class="flex items-center justify-between mb-2">
    <h5 class="m-0">Manage All super stars</h5>
  </div>
  <app-table [headers]="tableHeaders" [showActions]="true" [data]="superStars" (edit)="editSuperStar($event)"
    (delete)="deleteSuperStar($event)"></app-table>
</p-card>

<!-- here is the dialog needed to add or update a new super star-->
<p-dialog [header]="isEdit ? 'Update selected super star' : 'Add New Super Star'" [(visible)]="showAddDialog"
  [modal]="true" [style]="{width: '100vw', maxWidth: '700px'}">
  @if(!isDelete){
  <form [formGroup]="addSuperStarForm" class="mt-4">
    <div class="row g-3">

      <!-- Name -->
      <div class="col-12 col-md-4">
        <div class="form-floating">
          <input type="text" id="name" class="form-control" formControlName="name" placeholder="Athlete Name"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('name')?.invalid && addSuperStarForm.get('name')?.touched }">
          <label for="name">Athlete Name</label>
          <div *ngIf="addSuperStarForm.get('name')?.errors && addSuperStarForm.get('name')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('name')?.errors?.['required']">Athlete name is required.</div>
            <div *ngIf="addSuperStarForm.get('name')?.errors?.['pattern']">Only letters are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Sport (Arabic) -->
      <div class="col-12 col-md-4">
        <div class="form-floating">
          <input type="text" id="sport" class="form-control" formControlName="sport"
            placeholder="Athlete Sport (Arabic)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('sport')?.invalid && addSuperStarForm.get('sport')?.touched }">
          <label for="sport">Athlete Sport (Arabic)</label>
          <div *ngIf="addSuperStarForm.get('sport')?.errors && addSuperStarForm.get('sport')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('sport')?.errors?.['required']">Athlete Sport (Arabic) is required.</div>
            <div *ngIf="addSuperStarForm.get('sport')?.errors?.['pattern']">Only Arabic letters are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Sport (English) -->
      <div class="col-12 col-md-4">
        <div class="form-floating">
          <input type="text" id="sportEn" class="form-control" formControlName="sportEn"
            placeholder="Athlete Sport (English)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('sportEn')?.invalid && addSuperStarForm.get('sportEn')?.touched }">
          <label for="sportEn">Athlete Sport (English)</label>
          <div *ngIf="addSuperStarForm.get('sportEn')?.errors && addSuperStarForm.get('sportEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('sportEn')?.errors?.['required']">Athlete Sport (English) is required.
            </div>
            <div *ngIf="addSuperStarForm.get('sportEn')?.errors?.['pattern']">Only English letters are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Achievement (Arabic) -->
      <div class="col-12 col-md-4">
        <div class="form-floating">
          <input type="text" id="achievement" class="form-control" formControlName="achievement"
            placeholder="Achievement (Arabic)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('achievement')?.invalid && addSuperStarForm.get('achievement')?.touched }">
          <label for="achievement">Achievement (Arabic)</label>
          <div *ngIf="addSuperStarForm.get('achievement')?.errors && addSuperStarForm.get('achievement')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('achievement')?.errors?.['required']">Achievement (Arabic) is required.
            </div>
            <div *ngIf="addSuperStarForm.get('achievement')?.errors?.['pattern']">Only Arabic letters are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Achievement (English) -->
      <div class="col-12 col-md-4">
        <div class="form-floating">
          <input type="text" id="achievementEn" class="form-control" formControlName="achievementEn"
            placeholder="Achievement (English)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('achievementEn')?.invalid && addSuperStarForm.get('achievementEn')?.touched }">
          <label for="achievementEn">Achievement (English)</label>
          <div *ngIf="addSuperStarForm.get('achievementEn')?.errors && addSuperStarForm.get('achievementEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('achievementEn')?.errors?.['required']">Achievement (English) is required.
            </div>
            <div *ngIf="addSuperStarForm.get('achievementEn')?.errors?.['pattern']">Only English letters are allowed.
            </div>
          </div>
        </div>
      </div>

      <!-- Description (Arabic) -->
      <div class="col-12 col-md-6">
        <div class="form-floating">
          <textarea id="description" class="form-control" rows="3" formControlName="description"
            placeholder="Description (Arabic)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('description')?.invalid && addSuperStarForm.get('description')?.touched }"></textarea>
          <label for="description">Description (Arabic)</label>
          <div *ngIf="addSuperStarForm.get('description')?.errors && addSuperStarForm.get('description')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('description')?.errors?.['required']">Description (Arabic) is required.
            </div>
            <div *ngIf="addSuperStarForm.get('description')?.errors?.['pattern']">Only Arabic letters, numbers and basic
              punctuation are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Description (English) -->
      <div class="col-12 col-md-6">
        <div class="form-floating">
          <textarea id="descriptionEn" class="form-control" rows="3" formControlName="descriptionEn"
            placeholder="Description (English)"
            [ngClass]="{ 'is-invalid': addSuperStarForm.get('descriptionEn')?.invalid && addSuperStarForm.get('descriptionEn')?.touched }"></textarea>
          <label for="descriptionEn">Description (English)</label>
          <div *ngIf="addSuperStarForm.get('descriptionEn')?.errors && addSuperStarForm.get('descriptionEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addSuperStarForm.get('descriptionEn')?.errors?.['required']">Description (English) is required.
            </div>
            <div *ngIf="addSuperStarForm.get('descriptionEn')?.errors?.['pattern']">Only English letters, numbers and
              basic punctuation are allowed.</div>
          </div>
        </div>
      </div>

      <!-- Is Elite -->
      <div class="col-12 col-md-4 d-flex align-items-center mt-2">
        <input type="checkbox" class="form-check-input me-2" formControlName="isElite" id="isElite">
        <label class="form-check-label" for="isElite">Is Elite Athlete?</label>
      </div>

      <!-- Image Upload -->
      <div class="col-12 mt-3">
        <label for="image">Athlete Image</label>
        <input type="file" class="form-control" accept="image/*" (change)="onImageUpload($event)">
        <div *ngIf="addSuperStarForm.get('image')?.value">
          <img [src]="imgUrl + addSuperStarForm.get('image')?.value" alt="Preview" class="mt-2 img-thumbnail"
            style="width: 120px; height: 120px; object-fit: cover;">
        </div>
      </div>

    </div>
  </form>

  }

  @else {
  <p class="font-bold text-center">Are you sure to deactivate the selected super star ?</p>
  }


  @if(!isDelete){
  <div class=" flex justify-end gap-2 mt-4">
    <p-button severity="success" label="Save" icon="pi pi-check" type="submit" [disabled]="!addSuperStarForm.valid"
      (onClick)="!isDelete ? isEdit ? updateSelectedSuperStar() :addNewSuperStar() : deleteSelectedSuperStar()" />

    <p-button severity="danger" label="Cancel" icon="pi pi-times" (click)="showAddDialog = false" class="p-button-text"
      type="button" />
  </div>
  }

  @if(isDelete){

  <div class=" flex justify-end gap-2 mt-4">
    <p-button severity="success" label="Save" icon="pi pi-check" type="submit" (onClick)="deleteSelectedSuperStar() " />
    <p-button severity="danger" label="Cancel" icon="pi pi-times" (click)="showAddDialog = false" class="p-button-text"
      type="button" />
  </div>
  }

</p-dialog>
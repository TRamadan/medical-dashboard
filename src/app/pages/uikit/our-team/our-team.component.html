<p-toolbar styleClass="mb-6">
  <ng-template pTemplate="start">
    <div class="flex flex-wrap gap-2">
      <p-button icon="pi pi-plus" raised label="New" class="mr-2" (onClick)="openTeamDialog()" />
    </div>
  </ng-template>

  <ng-template pTemplate="end">
    <p-button label="Export" icon="pi pi-upload" severity="secondary" />
  </ng-template>
</p-toolbar>
<p-toast></p-toast>


<p-card>
  <div class="flex items-center justify-between mb-2">
    <h5 class="m-0">Manage All team members</h5>
  </div>

  <ng-template #advisorsTab>
    <app-table [headers]="advisorsHeader" [data]="allAdvisors" [paginator]="true" [rows]="10"
      [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 20, 30]" [showGlobalFilter]="true"
      [globalFilterPlaceholder]="'Search...'" [showActions]="true" (edit)="editSelectedAdvisor($event)"
      (delete)="deleteSelectedAdvisor($event)"></app-table>
  </ng-template>

  <ng-template #teamMemberTab>
    <app-table [headers]="teamMembersHeader" [data]="allTeamMembers" [paginator]="true" [rows]="10"
      [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 20, 30]" [showGlobalFilter]="true"
      [globalFilterPlaceholder]="'Search...'" [showActions]="true" (edit)="editTeamMember($event)"
      (delete)="deleteTeamMember($event)"></app-table>
  </ng-template>

  <app-tabs [tabs]="[
    { label: 'Our Advisors', template: advisorsTab },
    { label: 'Our Team members', template: teamMemberTab },
    
]" [activeIndex]="activeTabIndex" (tabChange)="onTabChange($event)"></app-tabs>
</p-card>

<!-- here is the dialog needed to handle the add, update and delete-->
<p-dialog [header]="isEdit ? 'Update selected team' : 'Add New Team member'" [(visible)]="showAddDialog" [modal]="true"
  [style]="{width: '100vw', maxWidth: '550px'}">
  @if(!isDelete) {
  <ng-template #advisorsFormTab>
    <form [formGroup]="addAdvisorForm" class="container mt-3">
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="name" class="form-label">Name</label>
          <input id="name" type="text" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('name')?.invalid && addAdvisorForm.get('name')?.touched }"
            formControlName="name">
          <div *ngIf="addAdvisorForm.get('name')?.errors && addAdvisorForm.get('name')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('name')?.errors?.['required']">Name is required.</div>
            <div *ngIf="addAdvisorForm.get('name')?.errors?.['pattern']">Only English letters (3–50 chars) are allowed.
            </div>
          </div>
        </div>
      </div>

      <!-- Job Fields -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="jobAr" class="form-label">Job (Arabic)</label>
          <input id="jobAr" type="text" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('jobAr')?.invalid && addAdvisorForm.get('jobAr')?.touched }"
            formControlName="jobAr">
          <div *ngIf="addAdvisorForm.get('jobAr')?.errors && addAdvisorForm.get('jobAr')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('jobAr')?.errors?.['required']">Job (Arabic) is required.</div>
            <div *ngIf="addAdvisorForm.get('jobAr')?.errors?.['pattern']">Only Arabic letters (2–50 chars) are allowed.
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <label for="jobEn" class="form-label">Job (English)</label>
          <input id="jobEn" type="text" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('jobEn')?.invalid && addAdvisorForm.get('jobEn')?.touched }"
            formControlName="jobEn">
          <div *ngIf="addAdvisorForm.get('jobEn')?.errors && addAdvisorForm.get('jobEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('jobEn')?.errors?.['required']">Job (English) is required.</div>
            <div *ngIf="addAdvisorForm.get('jobEn')?.errors?.['pattern']">Only English letters (2–50 chars) are allowed.
            </div>
          </div>
        </div>
      </div>

      <!-- Job Descriptions -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="jobDescriptionAr" class="form-label">Job Description (Arabic)</label>
          <textarea id="jobDescriptionAr" rows="3" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('jobDescriptionAr')?.invalid && addAdvisorForm.get('jobDescriptionAr')?.touched }"
            formControlName="jobDescriptionAr"></textarea>
          <div *ngIf="addAdvisorForm.get('jobDescriptionAr')?.errors && addAdvisorForm.get('jobDescriptionAr')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('jobDescriptionAr')?.errors?.['required']">Job Description (Arabic) is
              required.</div>
            <div *ngIf="addAdvisorForm.get('jobDescriptionAr')?.errors?.['pattern']">Must be 10–200 Arabic characters.
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <label for="jobDescriptionEn" class="form-label">Job Description (English)</label>
          <textarea id="jobDescriptionEn" rows="3" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('jobDescriptionEn')?.invalid && addAdvisorForm.get('jobDescriptionEn')?.touched }"
            formControlName="jobDescriptionEn"></textarea>
          <div *ngIf="addAdvisorForm.get('jobDescriptionEn')?.errors && addAdvisorForm.get('jobDescriptionEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('jobDescriptionEn')?.errors?.['required']">Job Description (English) is
              required.</div>
            <div *ngIf="addAdvisorForm.get('jobDescriptionEn')?.errors?.['pattern']">Must be 10–200 English characters.
            </div>
          </div>
        </div>
      </div>

      <!-- Short Paragraphs -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="shortParagraphAr" class="form-label">Short Paragraph (Arabic)</label>
          <textarea id="shortParagraphAr" rows="3" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('shortParagraphAr')?.invalid && addAdvisorForm.get('shortParagraphAr')?.touched }"
            formControlName="shortParagraphAr"></textarea>
          <div *ngIf="addAdvisorForm.get('shortParagraphAr')?.errors && addAdvisorForm.get('shortParagraphAr')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('shortParagraphAr')?.errors?.['required']">Short Paragraph (Arabic) is
              required.</div>
            <div *ngIf="addAdvisorForm.get('shortParagraphAr')?.errors?.['pattern']">Must be 10–300 Arabic characters.
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <label for="shortParagraphEn" class="form-label">Short Paragraph (English)</label>
          <textarea id="shortParagraphEn" rows="3" class="form-control"
            [ngClass]="{ 'is-invalid': addAdvisorForm.get('shortParagraphEn')?.invalid && addAdvisorForm.get('shortParagraphEn')?.touched }"
            formControlName="shortParagraphEn"></textarea>
          <div *ngIf="addAdvisorForm.get('shortParagraphEn')?.errors && addAdvisorForm.get('shortParagraphEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addAdvisorForm.get('shortParagraphEn')?.errors?.['required']">Short Paragraph (English) is
              required.</div>
            <div *ngIf="addAdvisorForm.get('shortParagraphEn')?.errors?.['pattern']">Must be 10–300 English characters.
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <app-file-upload-input folderName="Advisors" formControlName="image"
          label="Advisor image"></app-file-upload-input>
      </div>
    </form>
  </ng-template>

  <ng-template #addTeamFormTab>
    <form [formGroup]="addTeamForm" class="container mt-3">

      <!-- Name -->
      <div class="row mb-3">
        <div class="col-md-12">
          <label for="name" class="form-label">Name</label>
          <input id="name" type="text" class="form-control" formControlName="name"
            [ngClass]="{ 'is-invalid': addTeamForm.get('name')?.invalid && addTeamForm.get('name')?.touched }">
          <div *ngIf="addTeamForm.get('name')?.errors && addTeamForm.get('name')?.touched" class="invalid-feedback">
            <div *ngIf="addTeamForm.get('name')?.errors?.['required']">Name is required.</div>
            <div *ngIf="addTeamForm.get('name')?.errors?.['pattern']">Only English letters (3–50 chars).</div>
          </div>
        </div>
      </div>

      <!-- Role (Arabic & English) -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="roleAr" class="form-label">Role (Arabic)</label>
          <input id="roleAr" type="text" class="form-control" formControlName="roleAr"
            [ngClass]="{ 'is-invalid': addTeamForm.get('roleAr')?.invalid && addTeamForm.get('roleAr')?.touched }">
          <div *ngIf="addTeamForm.get('roleAr')?.errors && addTeamForm.get('roleAr')?.touched" class="invalid-feedback">
            <div *ngIf="addTeamForm.get('roleAr')?.errors?.['required']">Role (Arabic) is required.</div>
            <div *ngIf="addTeamForm.get('roleAr')?.errors?.['pattern']">Only Arabic letters (2–50 chars).</div>
          </div>
        </div>

        <div class="col-md-6">
          <label for="roleEn" class="form-label">Role (English)</label>
          <input id="roleEn" type="text" class="form-control" formControlName="roleEn"
            [ngClass]="{ 'is-invalid': addTeamForm.get('roleEn')?.invalid && addTeamForm.get('roleEn')?.touched }">
          <div *ngIf="addTeamForm.get('roleEn')?.errors && addTeamForm.get('roleEn')?.touched" class="invalid-feedback">
            <div *ngIf="addTeamForm.get('roleEn')?.errors?.['required']">Role (English) is required.</div>
            <div *ngIf="addTeamForm.get('roleEn')?.errors?.['pattern']">Only English letters (2–50 chars).</div>
          </div>
        </div>
      </div>

      <!-- Specialization (Arabic & English) -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="specializationAr" class="form-label">Specialization (Arabic)</label>
          <input id="specializationAr" type="text" class="form-control" formControlName="specializationAr"
            [ngClass]="{ 'is-invalid': addTeamForm.get('specializationAr')?.invalid && addTeamForm.get('specializationAr')?.touched }">
          <div *ngIf="addTeamForm.get('specializationAr')?.errors && addTeamForm.get('specializationAr')?.touched"
            class="invalid-feedback">
            <div *ngIf="addTeamForm.get('specializationAr')?.errors?.['required']">Specialization (Arabic) is
              required.</div>
            <div *ngIf="addTeamForm.get('specializationAr')?.errors?.['pattern']">Only Arabic letters (2–100 chars).
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <label for="specializationEn" class="form-label">Specialization (English)</label>
          <input id="specializationEn" type="text" class="form-control" formControlName="specializationEn"
            [ngClass]="{ 'is-invalid': addTeamForm.get('specializationEn')?.invalid && addTeamForm.get('specializationEn')?.touched }">
          <div *ngIf="addTeamForm.get('specializationEn')?.errors && addTeamForm.get('specializationEn')?.touched"
            class="invalid-feedback">
            <div *ngIf="addTeamForm.get('specializationEn')?.errors?.['required']">Specialization (English) is
              required.</div>
            <div *ngIf="addTeamForm.get('specializationEn')?.errors?.['pattern']">Only English letters (2–100 chars).
            </div>
          </div>
        </div>
      </div>

      <!-- Image Upload -->
      <div class="row mb-3">
        <div class="col-md-12">
          <app-file-upload-input [folderName]="'Team member'" formControlName="image"></app-file-upload-input>
        </div>
      </div>


    </form>

  </ng-template>
  <app-tabs [tabs]="[
    { label: 'Add new advisor', template: advisorsFormTab },
    { label: 'Add new team member', template: addTeamFormTab },
    
]" [activeIndex]="activeTabIndex" (tabChange)="onTabChange($event)"></app-tabs>
  }
  @else {
  <p class="font-bold text-center">Are you sure you want to delete this Success story?</p>
  }

  <div class="flex justify-end gap-2 mt-4">
    <p-button severity="danger" label="Cancel" icon="pi pi-times"
      (onClick)="showAddDialog = false; isEdit=false; isDelete=false;" class="p-button-text" />
    <p-button severity="success" label="Save" icon="pi pi-check"
      [disabled]="isDelete ? false : (activeTabIndex === 0 ? addAdvisorForm.invalid : addTeamForm.invalid)"
      (onClick)="onSave()" />
  </div>
</p-dialog>
<p-toolbar styleClass="mb-6">
  <ng-template pTemplate="start">
    <p-button label="New" icon="pi pi-plus" severity="success" (onClick)="openNewMethodologySection()" />
  </ng-template>
  <ng-template pTemplate="end">
    <p-button label="Export" icon="pi pi-upload" severity="secondary" />
  </ng-template>
</p-toolbar>
<p-toast></p-toast>


<!-- Use the shared dynamic table component -->
<p-card>
  <div class="flex items-center justify-between mb-2">
    <h5 class="m-0">Manage Methodology and cutting edge technology</h5>
  </div>
  <app-table [headers]="tableHeaders" [data]="allMethodologies" [showActions]="true" (edit)="editMethodology($event)"
    (delete)="deleteMethodology($event)"></app-table>
</p-card>

<!-- Dialog for adding/editing partners -->
<p-dialog [header]="isEdit ?'Update selected methodology item' : 'Add new methodology item'" [(visible)]="showAddDialog"
  [modal]="true" [style]="{width: '90vw', maxWidth: '550px'}">
  @if(!isDelete) {
  <form [formGroup]="addMethodologiesConfig" class="mt-4">
    <div class="row g-3">

      <!-- Title (Arabic) -->
      <div class="col-md-6">
        <label for="title">Title (Arabic)</label>
        <input type="text" id="title" class="form-control" formControlName="title"
          [ngClass]="{ 'is-invalid': addMethodologiesConfig.get('title')?.invalid && addMethodologiesConfig.get('title')?.touched }">
        @if (addMethodologiesConfig.get('title')?.errors && addMethodologiesConfig.get('title')?.touched) {
        <div class="invalid-feedback">
          @if (addMethodologiesConfig.get('title')?.errors?.['required']) { <div>Title (Arabic) is required.</div> }
          @if (addMethodologiesConfig.get('title')?.errors?.['pattern']) { <div>Only Arabic letters are allowed.</div>
          }
        </div>
        }
      </div>

      <!-- Title (English) -->
      <div class="col-md-6">
        <label for="titleEn">Title (English)</label>
        <input type="text" id="titleEn" class="form-control" formControlName="titleEn"
          [ngClass]="{ 'is-invalid': addMethodologiesConfig.get('titleEn')?.invalid && addMethodologiesConfig.get('titleEn')?.touched }">
        @if (addMethodologiesConfig.get('titleEn')?.errors && addMethodologiesConfig.get('titleEn')?.touched) {
        <div class="invalid-feedback">
          @if (addMethodologiesConfig.get('titleEn')?.errors?.['required']) { <div>Title (English) is required.</div>
          }
          @if (addMethodologiesConfig.get('titleEn')?.errors?.['pattern']) { <div>Only English letters are allowed.
          </div> }
        </div>
        }
      </div>

      <!-- Description (Arabic) -->
      <div class="col-12 col-md-6">
        <label for="description">Description (Arabic)</label>
        <textarea id="description" class="form-control" rows="3" formControlName="description"
          placeholder="Description (Arabic)"
          [ngClass]="{ 'is-invalid': addMethodologiesConfig.get('description')?.invalid && addMethodologiesConfig.get('description')?.touched }"></textarea>
        @if (addMethodologiesConfig.get('description')?.errors && addMethodologiesConfig.get('description')?.touched)
        {
        <div class="invalid-feedback">
          @if (addMethodologiesConfig.get('description')?.errors?.['required']) { <div>Description (Arabic) is
            required.</div> }
          @if (addMethodologiesConfig.get('description')?.errors?.['pattern']) { <div>Only Arabic letters, numbers and
            basic punctuation are allowed.</div> }
        </div>
        }
      </div>

      <!-- Description (English) -->
      <div class="col-12 col-md-6">
        <label for="descriptionEn">Description (English)</label>
        <textarea id="descriptionEn" class="form-control" rows="3" formControlName="descriptionEn"
          placeholder="Description (English)"
          [ngClass]="{ 'is-invalid': addMethodologiesConfig.get('descriptionEn')?.invalid && addMethodologiesConfig.get('descriptionEn')?.touched }"></textarea>
        @if (addMethodologiesConfig.get('descriptionEn')?.errors &&
        addMethodologiesConfig.get('descriptionEn')?.touched) {
        <div class="invalid-feedback">
          @if (addMethodologiesConfig.get('descriptionEn')?.errors?.['required']) { <div>Description (English) is
            required.</div> }
          @if (addMethodologiesConfig.get('descriptionEn')?.errors?.['pattern']) { <div>Only English letters, numbers
            and basic punctuation are allowed.</div> }
        </div>
        }
      </div>

      <!-- Checkbox -->
      <div class="col-12 col-md-4 d-flex align-items-center mt-2 w-100">
        <input type="checkbox" class="form-check-input me-2" formControlName="isCuttingEdgeTechnology"
          id="isCuttingEdgeTechnology">
        <label class="form-check-label" for="isCuttingEdgeTechnology">Is Cutting Edge Technology?</label>
      </div>

      <!-- Image Upload -->
      <div class="col-12 mt-3">
        <label for="icon">Image</label>
        <input type="file" class="form-control" accept="image/*" (change)="onImageUpload($event)">
        @if (addMethodologiesConfig.get('icon')?.value) {
        <img [src]="imgUrl + addMethodologiesConfig.get('icon')?.value" alt="Preview" class="mt-2 img-thumbnail"
          style="width: 120px; height: 120px; object-fit: cover;">
        }
      </div>

    </div>
  </form>

  }
  @else {
  <p class="font-bold text-center">Are you sure you want to delete this methodolgoy?</p>
  }

  <div class="flex justify-end gap-2 mt-4">
    <p-button severity="danger" label="Cancel" icon="pi pi-times" (onClick)="showAddDialog = false"
      class="p-button-text" />
    <p-button severity="success" label="Save" icon="pi pi-check"
      (onClick)=" !isDelete ? (isEdit ? updatedMethodology() : addNewMethodology()) : deleteSelectedMethodology()" />
  </div>
</p-dialog>
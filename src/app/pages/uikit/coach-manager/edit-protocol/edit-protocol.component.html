<div class="container my-3">
    <div class="row align-items-center g-2">
        <div class="container my-4">
            <div class="alert alert-primary  p-3 rounded-3" role="alert" style="border-left: 5px solid #3890f5;">
                <div class="flex-grow-1">
                    <h5 class="mb-1 fw-bold">Edit Protocol from Template</h5>
                    <p class="mb-0">You can customize the exercise protocols created by the doctor to fit specific
                        patient needs.</p>
                </div>

                <button class="btn  btn-primary mt-3">Edit Protocol</button>
            </div>
        </div>
    </div>
</div>

<p>
    klkflskflskf
</p>

@if(selectedPatient){
<p-accordion [value]="0">
    @for (phase of selectedPatient.treatmentPlan.phases; track phase.phaseName; let i = $index) {
    <p-accordion-panel [value]="i">
        <p-accordion-header>
            <span class="font-bold">{{ phase.phaseName }}</span>
        </p-accordion-header>
        <p-accordion-content>
            <div class="flex flex-column gap-4">
                @for(week of phase.weeks; track week.weekName){
                <div class="card border-1 surface-border">
                    <div class="mb-3 font-bold text-lg">{{week.weekName}}</div>
                    <p-tabView>
                        @for(session of week.sessions; track session.name){
                        <p-tabPanel [header]="session.name">
                            <div class="flex flex-column gap-4">
                                @for(section of session.sections; track section; let sectionIndex = $index){
                                <div class="p-3 surface-card border-round shadow-1 mb-3">
                                    <div class="flex align-items-center justify-content-between mb-3">
                                        <div class="flex align-items-center gap-2">
                                            <div class="flex align-items-center justify-content-center bg-gray-500 text-white font-bold border-circle"
                                                style="width: 2rem; height: 2rem;">
                                                {{ sectionIndex + 1 }}
                                            </div>
                                            <span class="font-bold text-xl">{{ section.name }}</span>
                                        </div>
                                        <button pButton icon="pi pi-trash"
                                            class="p-button-text p-button-danger p-button-rounded"></button>
                                    </div>

                                    <div class="grid formgrid p-fluid mb-3">
                                        <div class="col-12 md:col-6">
                                            <label class="font-bold mb-2 block">Time</label>
                                            <input pInputText [(ngModel)]="section.time" placeholder="e.g. 10" />
                                        </div>
                                        <div class="col-12 md:col-6">
                                            <label class="font-bold mb-2 block">Coach manager</label>
                                            <p-dropdown [options]="coaches" [(ngModel)]="section.coachManager"
                                                placeholder="Select Coach Manager"></p-dropdown>
                                        </div>
                                    </div>

                                    <p-table [value]="section.exercises" styleClass="p-datatable-sm">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Sets</th>
                                                <th>Reps</th>
                                                <th>Intensity</th>
                                                <th>Tempo</th>
                                                <th>Rest</th>
                                                <th>Video URL</th>
                                                <th style="width: 3rem"></th>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="body" let-exercise let-exerciseIndex="rowIndex">
                                            <tr>
                                                <td><input pInputText [(ngModel)]="exercise.name" class="w-full" /></td>
                                                <td><input pInputText [(ngModel)]="exercise.description"
                                                        class="w-full" /></td>
                                                <td><p-inputNumber [(ngModel)]="exercise.sets" [showButtons]="true"
                                                        buttonLayout="horizontal" inputStyleClass="w-3rem text-center"
                                                        [min]="0"></p-inputNumber></td>
                                                <td><p-inputNumber [(ngModel)]="exercise.reps" [showButtons]="true"
                                                        buttonLayout="horizontal" inputStyleClass="w-3rem text-center"
                                                        [min]="0"></p-inputNumber></td>
                                                <td>
                                                    <p-dropdown [options]="intensityOptions"
                                                        [(ngModel)]="exercise.intensity" appendTo="body"
                                                        [style]="{'width':'100%'}">
                                                        <ng-template pTemplate="selectedItem">
                                                            <p-tag [value]="exercise.intensity"
                                                                [severity]="getSeverity(exercise.intensity)"></p-tag>
                                                        </ng-template>
                                                        <ng-template let-option pTemplate="item">
                                                            <p-tag [value]="option.label"
                                                                [severity]="getSeverity(option.label)"></p-tag>
                                                        </ng-template>
                                                    </p-dropdown>
                                                </td>
                                                <td><input pInputText [(ngModel)]="exercise.tempo" class="w-full" />
                                                </td>
                                                <td><input pInputText [(ngModel)]="exercise.rest" class="w-full" /></td>
                                                <td><input pInputText [(ngModel)]="exercise.videoUrl" class="w-full" />
                                                </td>
                                                <td>
                                                    <button pButton icon="pi pi-trash"
                                                        class="p-button-text p-button-danger p-button-rounded p-button-sm"
                                                        (click)="removeExercise(section, exerciseIndex)"></button>
                                                </td>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="footer">
                                            <tr>
                                                <td colspan="9">
                                                    <button pButton label="Add Exercise" icon="pi pi-plus"
                                                        class="p-button-text p-button-success"
                                                        (click)="addExercise(section)"></button>
                                                </td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <div class="flex justify-content-end gap-2 mt-3">
                                        <button pButton label="Cancel"
                                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                                        <button pButton label="Save" class="p-button-success p-button-sm"></button>
                                    </div>
                                </div>
                                }

                                <div class="flex justify-content-center">
                                    <button pButton label="Add New Section" icon="pi pi-plus-circle"
                                        class="p-button-outlined p-button-secondary"
                                        (click)="addSection(session)"></button>
                                </div>
                            </div>
                        </p-tabPanel>
                        }
                    </p-tabView>
                </div>
                }
            </div>
        </p-accordion-content>
    </p-accordion-panel>
    }
</p-accordion>
} @else {
<div class="text-center p-5 text-gray-500">
    <p>Please select a patient from the overview to edit their protocol.</p>
</div>
}
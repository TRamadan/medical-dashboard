<div class="dashboard-layout">
    <main class="main-content">
        <div class="filters-section">
            <div class="filter-group">
                <label for="branchFilter">Filter by Branch:</label>
                <select id="branchFilter" [(ngModel)]="selectedBranchId" class="filter-select" (change)="filterByBranch()">
                    <option value="">All Branches</option>
                    @for (branch of branches; track branch) {
                        <option [value]="branch.id">{{ branch.name }}</option>
                    }
                </select>
            </div>
        </div>

        <div class="schedules-container">
            @for (coach of coaches; track coach) {
                <div class="coach-schedule-card">
                    <div class="coach-header">
                        <div class="coach-info">
                            <h3>{{ coach.name }}</h3>
                            <p class="coach-branch">{{ coach.branch }} Branch</p>
                            <p class="coach-specializations"><strong>Specializations:</strong> {{ coach.specializations.join(', ') }}</p>
                            <p class="coach-workload">
                                <strong>Current Load:</strong> {{ coach.currentPatients }}/{{ coach.maxPatients }} patients
                                <span class="workload-bar">
                                    <span class="workload-fill" [style.width.%]="getWorkloadPercentage(coach)"></span>
                                </span>
                            </p>
                        </div>
                        <div class="d-flex gap-3">
                            <p-button label="Edit Schedule" [raised]="true" severity="warn" (onClick)="editSchedule(coach)" />
                            <p-button label="View Detailed" [raised]="true" severity="info" (onClick)="showFullCoachSchedule(coach)" />
                        </div>
                    </div>

                    <div class="schedule-grid">
                        @for (slot of coach.availability; track slot) {
                            <div class="time-slot">
                                <div class="slot-day">{{ slot.day }}</div>
                                <div class="slot-time">{{ slot.startTime }} - {{ slot.endTime }}</div>
                                <div class="slot-status" [class]="slot.isAvailable ? 'available' : 'unavailable'">
                                    {{ slot.isAvailable ? 'Working Day' : 'Day Off' }}
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </main>
    <!-- here is the dialog needed to make coach manager able to edit the schedule for the selected coach-->
    <p-dialog [header]="'Edit schedule'" [(visible)]="isEditScheduleDialog" [modal]="true" [style]="{ width: '50rem' }">
        <ng-template #footer>
            <p-button label="Cancel" [text]="true" severity="secondary" (click)="isEditScheduleDialog = false" />
            <p-button label="Save" [outlined]="true" severity="secondary" />
        </ng-template>
    </p-dialog>
</div>

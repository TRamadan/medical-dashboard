<p-toolbar styleClass="mb-6">
    <ng-template pTemplate="start">
        <div class="flex flex-wrap gap-2">
            <p-button icon="pi pi-plus" raised label="New" class="mr-2" (onClick)="openServiceDialog()" />
        </div>
    </ng-template>

    <ng-template pTemplate="end">
        <p-button label="Export" icon="pi pi-upload" severity="secondary" />
    </ng-template>
</p-toolbar>

<p-toast></p-toast>

<p-card>
    <div class="flex items-center justify-between mb-2">
        <h5 class="m-0">Manage Our success stories</h5>
    </div>
    <!-- Use the shared dynamic table component -->
    <app-table [headers]="tableHeaders" [data]="allSuccessStories" [showActions]="true"
        (edit)="editSuccessStory($event)" (delete)="deleteSuccessStory($event)"></app-table>
</p-card>


<!-- Dialog for adding/editing partners -->
<p-dialog [header]="isEdit ? 'Update Partner' : 'Add New Partner'" [(visible)]="showAddDialog" [modal]="true"
    [style]="{width: '90vw', maxWidth: '550px'}">
    @if(!isDelete) {
    <form [formGroup]="addSuccessStoryForm" class="container mt-3">

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="titleAr" class="form-label">Title (Arabic)</label>
                <input id="titleAr" type="text" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('titleAr')?.invalid && addSuccessStoryForm.get('titleAr')?.touched }"
                    formControlName="titleAr">
                <div *ngIf="addSuccessStoryForm.get('titleAr')?.errors && addSuccessStoryForm.get('titleAr')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('titleAr')?.errors?.['required']">Title (Arabic) is required.
                    </div>
                    <div *ngIf="addSuccessStoryForm.get('titleAr')?.errors?.['pattern']">Only Arabic letters are
                        allowed.</div>
                </div>
            </div>

            <div class="col-md-6">
                <label for="titleEn" class="form-label">Title (English)</label>
                <input id="titleEn" type="text" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('titleEn')?.invalid && addSuccessStoryForm.get('titleEn')?.touched }"
                    formControlName="titleEn">
                <div *ngIf="addSuccessStoryForm.get('titleEn')?.errors && addSuccessStoryForm.get('titleEn')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('titleEn')?.errors?.['required']">Title (English) is required.
                    </div>
                    <div *ngIf="addSuccessStoryForm.get('titleEn')?.errors?.['pattern']">Only English letters are
                        allowed.</div>
                </div>
            </div>
        </div>

        <!-- Description Fields -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="descriptionAr" class="form-label">Description (Arabic)</label>
                <textarea id="descriptionAr" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('descriptionAr')?.invalid && addSuccessStoryForm.get('descriptionAr')?.touched }"
                    rows="3" formControlName="descriptionAr"></textarea>
                <div *ngIf="addSuccessStoryForm.get('descriptionAr')?.errors && addSuccessStoryForm.get('descriptionAr')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('descriptionAr')?.errors?.['required']">Description (Arabic) is
                        required.</div>
                    <div *ngIf="addSuccessStoryForm.get('descriptionAr')?.errors?.['pattern']">Only Arabic text is
                        allowed.</div>
                </div>
            </div>

            <div class="col-md-6">
                <label for="descriptionEn" class="form-label">Description (English)</label>
                <textarea id="descriptionEn" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('descriptionEn')?.invalid && addSuccessStoryForm.get('descriptionEn')?.touched }"
                    rows="3" formControlName="descriptionEn"></textarea>
                <div *ngIf="addSuccessStoryForm.get('descriptionEn')?.errors && addSuccessStoryForm.get('descriptionEn')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('descriptionEn')?.errors?.['required']">Description (English) is
                        required.</div>
                    <div *ngIf="addSuccessStoryForm.get('descriptionEn')?.errors?.['pattern']">Only English text is
                        allowed.</div>
                </div>
            </div>
        </div>

        <!-- Checkbox -->
        <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="isSuccessStoryVideo"
                formControlName="isSuccessStoryVideo">
            <label for="isSuccessStoryVideo" class="form-check-label">Is Success Story Video?</label>
        </div>

        <!-- If true -> show videoUrl -->
        @if(addSuccessStoryForm.get('isSuccessStoryVideo')?.value) {
        <div class="mb-3">
            <label for="videoUrl" class="form-label">Video URL</label>
            <input id="videoUrl" type="text" class="form-control"
                [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('videoUrl')?.invalid && addSuccessStoryForm.get('videoUrl')?.touched }"
                formControlName="videoUrl">
            <div *ngIf="addSuccessStoryForm.get('videoUrl')?.errors && addSuccessStoryForm.get('videoUrl')?.touched"
                class="invalid-feedback">
                <div *ngIf="addSuccessStoryForm.get('videoUrl')?.errors?.['required']">Video URL is required.</div>
                <div *ngIf="addSuccessStoryForm.get('videoUrl')?.errors?.['pattern']">Please enter a valid URL.</div>
            </div>
        </div>
        }

        <!-- If false -> show image + name + descriptions -->
        @if(!addSuccessStoryForm.get('isSuccessStoryVideo')?.value) {
        <div class="mb-3">
            <app-file-upload-input formControlName="image" label="Success Story Image"></app-file-upload-input>
            <div *ngIf="addSuccessStoryForm.get('image')?.errors && addSuccessStoryForm.get('image')?.touched"
                class="text-danger small">
                <div *ngIf="addSuccessStoryForm.get('image')?.errors?.['required']">Image is required.</div>
            </div>
        </div>

        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input id="name" type="text" class="form-control"
                [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('name')?.invalid && addSuccessStoryForm.get('name')?.touched }"
                formControlName="name">
            <div *ngIf="addSuccessStoryForm.get('name')?.errors && addSuccessStoryForm.get('name')?.touched"
                class="invalid-feedback">
                <div *ngIf="addSuccessStoryForm.get('name')?.errors?.['required']">Name is required.</div>
                <div *ngIf="addSuccessStoryForm.get('name')?.errors?.['pattern']">Only Arabic or English letters are
                    allowed.</div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="personDescriptionAr" class="form-label">Person Description (Arabic)</label>
                <textarea id="personDescriptionAr" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('personDescriptionAr')?.invalid && addSuccessStoryForm.get('personDescriptionAr')?.touched }"
                    rows="3" formControlName="personDescriptionAr"></textarea>
                <div *ngIf="addSuccessStoryForm.get('personDescriptionAr')?.errors && addSuccessStoryForm.get('personDescriptionAr')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('personDescriptionAr')?.errors?.['required']">Person Description
                        (Arabic) is required.</div>
                </div>
            </div>

            <div class="col-md-6">
                <label for="personDescriptionEn" class="form-label">Person Description (English)</label>
                <textarea id="personDescriptionEn" class="form-control"
                    [ngClass]="{ 'is-invalid': addSuccessStoryForm.get('personDescriptionEn')?.invalid && addSuccessStoryForm.get('personDescriptionEn')?.touched }"
                    rows="3" formControlName="personDescriptionEn"></textarea>
                <div *ngIf="addSuccessStoryForm.get('personDescriptionEn')?.errors && addSuccessStoryForm.get('personDescriptionEn')?.touched"
                    class="invalid-feedback">
                    <div *ngIf="addSuccessStoryForm.get('personDescriptionEn')?.errors?.['required']">Person Description
                        (English) is required.</div>
                </div>
            </div>
        </div>
        }

    </form>

    }
    @else {
    <p class="font-bold text-center">Are you sure you want to delete this Success story?</p>
    }

    <div class="flex justify-end gap-2 mt-4">
        <p-button severity="danger" label="Cancel" icon="pi pi-times" (onClick)="showAddDialog = false"
            class="p-button-text" />
        <p-button severity="success" label="Save" icon="pi pi-check"
            [disabled]="!isDelete && !addSuccessStoryForm.valid"
            (onClick)="!isDelete ? (isEdit ? updateSelectedSuccessStory() : addNewSuccessStory()) : deleteSelectedSuccessStory()" />
    </div>
</p-dialog>
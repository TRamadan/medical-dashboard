<p-toolbar styleClass="mb-6">
    <ng-template pTemplate="start">
        <div class="flex flex-wrap gap-2">
            <p-button icon="pi pi-plus" raised label="New" class="mr-2" (onClick)="openServiceDialog()" />
        </div>
    </ng-template>

    <ng-template pTemplate="end">
        <p-button label="Export" icon="pi pi-upload" severity="secondary" />
    </ng-template>
</p-toolbar>

<!-- Use the shared dynamic table component -->
<app-table [headers]="tableHeaders" [data]="allSuccessStories" [showActions]="true" (edit)="editSuccessStory($event)"
    (delete)="deleteSuccessStory($event)"></app-table>

<!-- Dialog for adding/editing partners -->
<p-dialog [header]="isEdit ? 'Update Partner' : 'Add New Partner'" [(visible)]="showAddDialog" [modal]="true"
    [style]="{width: '90vw', maxWidth: '550px'}">
    @if(!isDelete) {
    <form [formGroup]="addSuccessStoryForm" class="flex flex-col gap-4">

        <div class="p-field">
            <label for="titleAr">Title (Arabic)</label>
            <input id="titleAr" pInputText formControlName="titleAr" />
        </div>

        <div class="p-field">
            <label for="titleEn">Title (English)</label>
            <input id="titleEn" pInputText formControlName="titleEn" />
        </div>

        <div class="p-field">
            <label for="descriptionAr">Description (Arabic)</label>
            <textarea id="descriptionAr" pInputTextarea formControlName="descriptionAr"></textarea>
        </div>

        <div class="p-field">
            <label for="descriptionEn">Description (English)</label>
            <textarea id="descriptionEn" pInputTextarea formControlName="descriptionEn"></textarea>
        </div>

        <div class="p-field-checkbox">
            <p-checkbox formControlName="isSuccessStoryVideo" binary="true" inputId="isSuccessStoryVideo">
            </p-checkbox>
            <label for="isSuccessStoryVideo">Is Success Story Video?</label>
        </div>


        @if(addSuccessStoryForm.get('isSuccessStoryVideo')?.value){
        <div class="p-field">
            <label for="videoUrl"></label>
            <input id="videoUrl" pInputText formControlName="videoUrl" />
        </div>
        }

        @if(!addSuccessStoryForm.get('isSuccessStoryVideo')?.value){
        <div class="flex flex-col gap-2">
            <label for="image">Success story Image</label>
            <p-fileUpload mode="basic" chooseLabel="Choose Image" [auto]="true" accept="image/*" [maxFileSize]="1000000"
                (onSelect)="onImageUpload($event)"></p-fileUpload>
            @if(uploadResponse) {
            <img [src]="uploadResponse" alt="Preview" class="mt-2 w-32 h-32 object-cover rounded-md">
            }
        </div>
        }


        <div class="p-field">
            <label for="name">Name</label>
            <input id="name" pInputText formControlName="name" />
        </div>

        <div class="p-field">
            <label for="personDescriptionAr">Person Description (Arabic)</label>
            <textarea id="personDescriptionAr" pInputTextarea formControlName="personDescriptionAr"></textarea>
        </div>

        <div class="p-field">
            <label for="personDescriptionEn">Person Description (English)</label>
            <textarea id="personDescriptionEn" pInputTextarea formControlName="personDescriptionEn"></textarea>
        </div>
    </form>
    }
    @else {
    <p class="font-bold text-center">Are you sure you want to delete this Success story?</p>
    }

    <div class="flex justify-end gap-2 mt-4">
        <p-button severity="danger" label="Cancel" icon="pi pi-times" (onClick)="showAddDialog = false"
            class="p-button-text" />
        <p-button severity="success" label="Save" icon="pi pi-check"
            [disabled]="!isDelete && !addSuccessStoryForm.valid"
            (onClick)="!isDelete ? (isEdit ? updateSelectedSuccessStory() : addNewSuccessStory()) : deleteSelectedSuccessStory()" />
    </div>
</p-dialog>